!function(Opal){Opal.dynamic_require_severity="error";var $a,$b,TMP_14,self=Opal.top,$scope=Opal,nil=Opal.nil,$breaker=Opal.breaker,$slice=Opal.slice,$klass=Opal.klass,$hash2=Opal.hash2,$range=Opal.range,$gvars=Opal.gvars;return Opal.add_stubs(["$attr_reader","$attr_accessor","$[]","$to_i","$decode_uri","$!","$empty?","$new","$to_n","$find","$on","$do_run","$match","$html","$value=","$strip","$do_copy","$do_next","$do_back","$do_clear","$do_show_lang","$do_change_lang","$get_content_from_server","$get_language","$get_cookie","$downcase","$===","$set_cookie","$get","$==","$status_code","$each","$[]=","$json","$update_load_prev","$create_index","$switch_to_last_used","$puts","$load_code","$load_code=","$+","$chapter","$title","$html=","$do_goto","$update_screen","$get_step_content","$>","$<=","$<","$has_key?","$update_current_edit","$value","$>=","$focus","$compile","$log_error","$eval_code","$-","$toggle_class","$gsub","$text","$answer","$saved_editor","$saved_output","$get_code_fragment","$to_s","$step","$length","$print_to_output","$last","$chomp","$ok","$mark_ok","$count_lines","$error","$mark_error","$count","$scan","$<<","$join","$ready?","$instance"]),Opal.cdecl($scope,"INITIAL_TRY_CODE","3.times do\n  print 'Welcome '\nend\n"),function(e,$super){function t(){}var r=t=$klass(e,$super,"TryRubyItem",t),n=r.$$proto,$=r.$$scope;return r.$attr_reader("lang","step","title","chapter","answer","ok","error","text","saved_editor","saved_output"),r.$attr_accessor("load_code"),n.$initialize=function(e,t){var r,n,i=this,o=nil,a=nil;return i.lang=t["$[]"]("lang"),i.step=e.$to_i(),i.title=t["$[]"]("title"),i.chapter=t["$[]"]("chapter"),o=i.$decode_uri(t["$[]"]("answer")),i.answer=function(){return(r=(n=o!==!1&&o!==nil)?o["$empty?"]()["$!"]():n)===nil||r.$$is_boolean&&1!=r?nil:$.get("Regexp").$new(o,"mi")}(),i.ok=i.$decode_uri(t["$[]"]("ok")),i.error=i.$decode_uri(t["$[]"]("error")),i.text=i.$decode_uri(t["$[]"]("text")),a=t["$[]"]("load_code"),i.load_code=function(){return(r=(n=a!==!1&&a!==nil)?a["$empty?"]()["$!"]():n)===nil||r.$$is_boolean&&1!=r?nil:i.$decode_uri(a)}(),i.saved_editor="",i.saved_output=""},n.$decode_uri=function(e){var t=nil;return t=decodeURIComponent(e)},n.$update_current_edit=function(e,t){var r=this;return r.saved_editor=e,r.saved_output=t},nil&&"update_current_edit"}(self,null),function(e,$super){function t(){}var r=t=$klass(e,$super,"Editor",t),n=r.$$proto;r.$$scope;return n["native"]=nil,n.$initialize=function(e,t){var r=this;return r["native"]=CodeMirror(document.getElementById(e),t.$to_n())},n["$value="]=function(e){var t=this;return t["native"].setValue(e)},n.$value=function(){var e=this;return e["native"].getValue()},n.$focus=function(){var e=this;return e["native"].focus()},n.$mark_ok=function(e){var t=this;return t["native"].markText({line:e,ch:0},{line:e,ch:99},{className:"tryruby-output-green"})},n.$mark_error=function(e){var t=this;return t["native"].markText({line:e,ch:0},{line:e,ch:99},{className:"tryruby-output-red"})},nil&&"mark_error"}(self,null),function($base,$super){function $TryRuby(){}var self=$TryRuby=$klass($base,$super,"TryRuby",$TryRuby),def=self.$$proto,$scope=self.$$scope;return def.editor=def.items=def.loaded=def.step=def.current_item=def.updating=def.output=def.current_copycode=def.output_buffer=nil,Opal.defs(self,"$instance",function(){var e,t=this;return null==t.instance&&(t.instance=nil),(e=t.instance)!==!1&&e!==nil?e:t.instance=t.$new()}),def.$initialize=function(){var e,t,r,n,$,i,o,a,s,l,u,c,p,d,_,f=this;return f.loaded=!1,f.items=nil,f.step=1,f.output_buffer=[],f.current_item=nil,f.current_copycode=nil,f.updating=!1,(e=$scope.get("Element").$find("#tryruby-title")["$empty?"]())===nil||e.$$is_boolean&&1!=e?(f.output=$scope.get("Editor").$new("output",$hash2(["lineNumbers","mode","readOnly","styleSelectedText"],{lineNumbers:!1,mode:"text",readOnly:!0,styleSelectedText:!0})),f.editor=$scope.get("Editor").$new("editor",$hash2(["lineNumbers","mode","tabMode","theme"],{lineNumbers:!1,mode:"ruby",tabMode:"shift",theme:"tomorrow-night-eighties"})),(e=(t=$scope.get("Element").$find("#btn_run")).$on,e.$$p=(r=function(){var e=r.$$s||this;return e.$do_run()},r.$$s=f,r),e).call(t,"click"),(e=$scope.get("Element").$find("#tryruby-title").$html().$match(/playground/i))===nil||e.$$is_boolean&&1!=e?((e=(n=$scope.get("Element").$find("#btn_copy")).$on,e.$$p=($=function(){var e=$.$$s||this;return e.$do_copy()},$.$$s=f,$),e).call(n,"click"),(e=(i=$scope.get("Element").$find("#btn_next")).$on,e.$$p=(o=function(){var e=o.$$s||this;return e.$do_next()},o.$$s=f,o),e).call(i,"click"),(e=(a=$scope.get("Element").$find("#btn_back")).$on,e.$$p=(s=function(){var e=s.$$s||this;return e.$do_back()},s.$$s=f,s),e).call(a,"click"),(e=(l=$scope.get("Element").$find("#btn_clear")).$on,e.$$p=(u=function(){var e=u.$$s||this;return e.$do_clear()},u.$$s=f,u),e).call(l,"click"),(e=(c=$scope.get("Element").$find("#tryruby-lang-toggle")).$on,e.$$p=(p=function(){var e=p.$$s||this;return e.$do_show_lang()},p.$$s=f,p),e).call(c,"click"),(e=(d=$scope.get("Element").$find("#tryruby-lang-select")).$on,e.$$p=(_=function(){var e=_.$$s||this;return e.$do_change_lang()},_.$$s=f,_),e).call(d,"change"),f.$get_content_from_server(f.$get_language())):(e=[$scope.get("INITIAL_TRY_CODE").$strip()],n=f.editor,n["$value="].apply(n,e),e[e.length-1],nil)):nil},def.$get_language=function(){var e,t,r=this,n=nil,$=nil,i=nil;return n=r.$get_cookie("tryruby_nl_language"),(e=n["$empty?"]())===nil||e.$$is_boolean&&1!=e||($=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage||navigator.browserLanguage,i=$.$downcase(),n="nl"["$==="](i)?"nl":"es"["$==="](i)?"es":"pt-br"["$==="](i)||"pt"["$==="](i)?"pt-br":"en",r.$set_cookie("tryruby_nl_language",n)),e=[n],t=$scope.get("Element").$find("#tryruby-lang-select"),t["$value="].apply(t,e),e[e.length-1],n},def.$get_content_from_server=function(e){var t,r,n,$=this;return(t=(r=$scope.get("HTTP")).$get,t.$$p=(n=function(e){var t,r,$,i=n.$$s||this;return null==e&&(e=nil),e.$status_code()["$=="](200)?(i.items=$hash2([],{}),(t=(r=e.$json()).$each,t.$$p=($=function(e,t){var r=$.$$s||this;return null==r.items&&(r.items=nil),null==e&&(e=nil),null==t&&(t=nil),r.items["$[]="](e.$to_i(),$scope.get("TryRubyItem").$new(e,t))},$.$$s=i,$),t).call(r),i.loaded=!0,i.$update_load_prev(),i.$create_index(),i.$switch_to_last_used()):i.$puts("\nWhoops ! Loading the tutorial failed (status = "+e.$status_code()+").\nPlease reload the page.")},n.$$s=$,n),t).call(r,"try_ruby_"+e+".json")},def.$update_load_prev=function(){var e,t,r,n=this,$=nil;return $="",(e=(t=n.items).$each,e.$$p=(r=function(e,t){var n,i,o;r.$$s||this;return null==e&&(e=nil),null==t&&(t=nil),o=t.$load_code(),i=o!==!1&&o!==nil?t.$load_code()["$empty?"]()["$!"]():o,(n=i!==!1&&i!==nil?t.$load_code()["$[]"]($range(0,3,!1))["$=="]("prev"):i)===nil||n.$$is_boolean&&1!=n||(n=[$["$+"](t.$load_code()["$[]"]($range(4,999999,!1)))],i=t,i["$load_code="].apply(i,n),n[n.length-1]),$=t.$load_code()},r.$$s=n,r),e).call(t)},def.$create_index=function(){var e,t,r,n,$,i=this,o=nil;return o="",(e=(t=i.items).$each,e.$$p=(r=function(e,t){r.$$s||this;return null==e&&(e=nil),null==t&&(t=nil),o=o["$+"]('<option value="'+e+'">'+function(){return t.$chapter()["$=="]("Y")?"":"&nbsp;&nbsp;&nbsp;"}()+t.$title()+"</option>\n")},r.$$s=i,r),e).call(t),e=[o],n=$scope.get("Element").$find("#tryruby-index"),n["$html="].apply(n,e),e[e.length-1],(e=(n=$scope.get("Element").$find("#tryruby-index")).$on,e.$$p=($=function(){var e=$.$$s||this;return e.$do_goto()},$.$$s=i,$),e).call(n,"change")},def.$get_cookie=function(e){var t,r,n=nil,$=nil;return n=document.cookie,(t=(r=n["$!"]())!==!1&&r!==nil?r:n["$empty?"]())===nil||t.$$is_boolean&&1!=t?($=n.$match($scope.get("Regexp").$new(""+e+"=(.*?)($|;|,(?! ))")),$!==!1&&$!==nil?$["$[]"](1).$strip():""):""},def.$set_cookie=function(e,t){return document.cookie=e+"="+t},def.$switch_to_last_used=function(){var e,t,r=this,n=nil;return n=r.$get_cookie("tryruby_nl_step").$to_i(),r.$update_screen(r.$get_step_content(function(){return n["$>"](0)?n:1}(),"","")),n["$<="](1)?(e=[$scope.get("INITIAL_TRY_CODE").$strip()],t=r.editor,t["$value="].apply(t,e),e[e.length-1],r.$do_run()):nil},def.$get_step_content=function(e,t,r){var n,$,i,o=this;return(n=($=(i=o.loaded["$!"]())!==!1&&i!==nil?i:e["$<"](1))!==!1&&$!==nil?$:o.items["$has_key?"](e)["$!"]())===nil||n.$$is_boolean&&1!=n?(o.step["$>"](0)&&o.items["$[]"](o.step).$update_current_edit(t,r),o.step=e,o.current_item=o.items["$[]"](e),o.current_item):nil},def.$do_goto=function(){var e,t=this,r=nil;return(e=t.updating)===nil||e.$$is_boolean&&1!=e?(r=$scope.get("Element").$find("#tryruby-index").$value().$to_i(),r["$>="](0)?t.$update_screen(t.$get_step_content(r,t.editor.$value(),t.output.$value())):nil):nil},def.$do_run=function(){var e,t,r,n=this,$=nil,i=nil,o=nil;if(n.output_buffer=[],e=[""],t=n.output,t["$value="].apply(t,e),e[e.length-1],n.editor.$focus(),$=n.editor.$value().$strip(),(e=$["$empty?"]())!==nil&&(!e.$$is_boolean||1==e))return nil;r=n.loaded,t=r!==!1&&r!==nil?n.current_item:r,(e=t!==!1&&t!==nil?n.current_item.$load_code():t)===nil||e.$$is_boolean&&1!=e||($=""+n.current_item.$load_code()+"\n"+$);try{i=$scope.get("Opal").$compile($,$hash2(["source_map_enabled"],{source_map_enabled:!1}))}catch(a){o=a,n.$log_error(o)}return n.$eval_code(i)},def.$do_copy=function(){var e,t,r=this;return e=[r.current_copycode],t=r.editor,t["$value="].apply(t,e),e[e.length-1],r.editor.$focus()},def.$do_next=function(){var e=this;return e.$update_screen(e.$get_step_content(e.step["$+"](1),e.editor.$value(),e.output.$value()))},def.$do_back=function(){var e=this;return e.$update_screen(e.$get_step_content(e.step["$-"](1),e.editor.$value(),e.output.$value()))},def.$do_clear=function(){var e,t,r=this;return e=[""],t=r.editor,t["$value="].apply(t,e),e[e.length-1],r.editor.$focus()},def.$do_show_lang=function(){return $scope.get("Element").$find("#tryruby-lang-hider").$toggle_class("hidden")},def.$do_change_lang=function(){var e=this,t=nil;return t=$scope.get("Element").$find("#tryruby-lang-select").$value(),e.$set_cookie("tryruby_nl_language",t),e.$get_content_from_server(t)},def.$get_code_fragment=function(e){var t=nil;return t=$scope.get("Element").$find("#tryruby-content code").$html().$strip(),t.$gsub("&lt;","<").$gsub("&gt;",">").$gsub("&amp;","&")},def.$update_screen=function(e){var t,r,n=this,$=nil;return(t=e["$!"]())===nil||t.$$is_boolean&&1!=t?(n.updating=!0,t=[e.$title()],r=$scope.get("Element").$find("#tryruby-title"),r["$html="].apply(r,t),t[t.length-1],t=[e.$text()],r=$scope.get("Element").$find("#tryruby-content"),r["$html="].apply(r,t),t[t.length-1],t=[e.$answer()],r=$scope.get("Element").$find("#tryruby-answer"),r["$html="].apply(r,t),t[t.length-1],t=[e.$saved_editor()],r=n.editor,r["$value="].apply(r,t),t[t.length-1],t=[e.$saved_output()],r=n.output,r["$value="].apply(r,t),t[t.length-1],n.current_copycode=n.$get_code_fragment(e.$text()),$=e.$step().$to_s(),t=[$],r=$scope.get("Element").$find("#tryruby-index"),r["$value="].apply(r,t),t[t.length-1],n.$set_cookie("tryruby_nl_step",$),n.editor.$focus(),n.updating=!1):nil},def.$eval_code=function(js_code){var $a,$b,self=this,retval=nil,err=nil,value_to_check=nil;retval=nil;try{retval=eval(js_code),retval=function(){return retval!==!1&&retval!==nil?retval.$to_s():""}(),($a=($b=self.output_buffer.$length()["$=="](0))?retval["$empty?"]()["$!"]():$b)===nil||$a.$$is_boolean&&1!=$a||self.$print_to_output(retval)}catch($err){err=$err,retval=""+err,self.$print_to_output(retval)}return($a=($b=self.current_item["$!"]())!==!1&&$b!==nil?$b:self.current_item.$answer()["$!"]())===nil||$a.$$is_boolean&&1!=$a?(value_to_check=function(){return($a=($b=self.output_buffer.$length()["$>"](0))?self.output_buffer.$last()["$empty?"]()["$!"]():$b)===nil||$a.$$is_boolean&&1!=$a?"":self.output_buffer.$last().$chomp()}(),$b=value_to_check["$empty?"]()["$!"](),($a=$b!==!1&&$b!==nil?value_to_check.$chomp().$match(self.current_item.$answer()):$b)===nil||$a.$$is_boolean&&1!=$a?(self.$print_to_output("\n"+self.current_item.$error()),self.output.$mark_error(self.$count_lines())):(self.$print_to_output("\n"+self.current_item.$ok()),self.output.$mark_ok(self.$count_lines()))):nil},def.$count_lines=function(){var e,t,r,n=this,$=nil;return $=0,(e=(t=n.output_buffer).$each,e.$$p=(r=function(e){r.$$s||this;return null==e&&(e=nil),$=$["$+"](e.$scan(/\n/).$count())},r.$$s=n,r),e).call(t),$["$-"](1)},def.$log_error=function(e){var t=this;return t.$print_to_output(""+e+"\n\n"+e.stack)},def.$print_to_output=function(e,t){var r,n,$=this;return null==t&&(t="\n"),$.output_buffer["$<<"](e.$to_s()["$+"](t)),r=[$.output_buffer.$join()],n=$.output,n["$value="].apply(n,r),r[r.length-1]},nil&&"print_to_output"}(self,null),($a=($b=$scope.get("Document"))["$ready?"],$a.$$p=(TMP_14=function(){TMP_14.$$s||this;return null==$gvars.stdout&&($gvars.stdout=nil),Opal.defs($gvars.stdout,"$puts",function(e){var t,r,n,$=this;return e=$slice.call(arguments,0),(t=(r=e).$each,t.$$p=(n=function(e){n.$$s||this;return null==e&&(e=nil),$scope.get("TryRuby").$instance().$print_to_output(e)},n.$$s=$,n),t).call(r),e.$last()}),Opal.defs($gvars.stdout,"$print",function(e){var t,r,n,$=this;return e=$slice.call(arguments,0),(t=(r=e).$each,t.$$p=(n=function(e){n.$$s||this;return null==e&&(e=nil),$scope.get("TryRuby").$instance().$print_to_output(e,"")},n.$$s=$,n),t).call(r),e.$last()}),$scope.get("TryRuby").$instance()},TMP_14.$$s=self,TMP_14),$a).call($b)}(Opal);